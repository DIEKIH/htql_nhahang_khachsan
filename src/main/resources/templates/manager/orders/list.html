<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý đơn hàng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/manager_sidebar.css}">
    <style>
        .order-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }
        .order-info-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .order-info-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="bg-light">
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div th:replace="fragments/manager_sidebar :: manager_sidebar"></div>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4 mt-3">
                <div>
                    <h2 class="mb-0 text-dark fw-bold">
                        <i class="fas fa-receipt text-primary me-2"></i>
                        Quản lý đơn hàng
                    </h2>
                    <p class="text-muted mb-0 mt-1">Quản lý tất cả đơn hàng trong chi nhánh</p>
                </div>
                <div>
                    <span class="badge bg-primary fs-6">
                        <i class="fas fa-box me-1"></i>
                        Tổng: <span th:text="${#lists.size(orders)}">0</span> đơn
                    </span>
                </div>
            </div>

            <!-- Flash Messages -->
            <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                <span th:text="${successMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>
                <span th:text="${errorMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- Search & Filter -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body">
                    <form method="get" action="/manager/orders" class="row g-3">
                        <div class="col-md-3">
                            <label for="orderCode" class="form-label fw-medium">Mã đơn hàng</label>
                            <input type="text" class="form-control" id="orderCode" name="orderCode"
                                   th:value="${searchOrderCode}" placeholder="VD: ORD123...">
                        </div>
                        <div class="col-md-2">
                            <label for="status" class="form-label fw-medium">Trạng thái đơn</label>
                            <select class="form-select" id="status" name="status">
                                <option value="">Tất cả</option>
                                <option th:each="statusOption : ${orderStatuses}"
                                        th:value="${statusOption}"
                                        th:selected="${statusOption == searchStatus}"
                                        th:text="${statusOption}">
                                </option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="orderType" class="form-label fw-medium">Loại đơn</label>
                            <select class="form-select" id="orderType" name="orderType">
                                <option value="">Tất cả</option>
                                <option th:each="typeOption : ${orderTypes}"
                                        th:value="${typeOption}"
                                        th:selected="${typeOption == searchOrderType}"
                                        th:text="${typeOption == T(com.example.htql_nhahang_khachsan.enums.OrderType).ONLINE ? 'Online' : 'Tại quầy'}">
                                </option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="paymentStatus" class="form-label fw-medium">Thanh toán</label>
                            <select class="form-select" id="paymentStatus" name="paymentStatus">
                                <option value="">Tất cả</option>
                                <option th:each="paymentOption : ${paymentStatuses}"
                                        th:value="${paymentOption}"
                                        th:selected="${paymentOption == searchPaymentStatus}"
                                        th:text="${paymentOption}">
                                </option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-medium">Từ ngày - Đến ngày</label>
                            <div class="input-group">
                                <input type="date" class="form-control" name="fromDate" th:value="${searchFromDate}">
                                <input type="date" class="form-control" name="toDate" th:value="${searchToDate}">
                            </div>
                        </div>
                        <div class="col-12 d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search me-2"></i>Tìm kiếm
                            </button>
                            <a href="/manager/orders" class="btn btn-outline-secondary">
                                <i class="fas fa-redo me-2"></i>Làm mới
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Orders List -->
            <div th:if="${#lists.isEmpty(orders)}" class="text-center py-5">
                <i class="fas fa-receipt fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">Chưa có đơn hàng nào</h5>
                <p class="text-muted">Các đơn hàng sẽ hiển thị tại đây</p>
            </div>

            <div th:if="${!#lists.isEmpty(orders)}" class="row g-3">
                <div th:each="order : ${orders}" class="col-12">
                    <div class="card order-card border-0 shadow-sm"
                         th:classappend="${order.status == T(com.example.htql_nhahang_khachsan.enums.OrderStatus).PENDING ? 'border-warning' :
                                        order.status == T(com.example.htql_nhahang_khachsan.enums.OrderStatus).COMPLETED ? 'border-success' :
                                        order.status == T(com.example.htql_nhahang_khachsan.enums.OrderStatus).CANCELLED ? 'border-danger' : 'border-info'}">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <!-- Order Info -->
                                <div class="col-md-3">
                                    <h6 class="fw-bold text-primary mb-1" th:text="${order.orderCode}">ORD123456</h6>
                                    <small class="text-muted">
                                        <i class="far fa-clock me-1"></i>
                                        <span th:text="${#temporals.format(order.orderTime, 'dd/MM/yyyy HH:mm')}">01/01/2024 12:00</span>
                                    </small>
                                    <div class="mt-2">
                                        <span class="badge rounded-pill"
                                              th:classappend="${order.orderType == T(com.example.htql_nhahang_khachsan.enums.OrderType).ONLINE ? 'bg-info' : 'bg-secondary'}"
                                              th:text="${order.orderType == T(com.example.htql_nhahang_khachsan.enums.OrderType).ONLINE ? 'Online' : 'Tại quầy'}">
                                        </span>
                                    </div>
                                </div>

                                <!-- Customer Info -->
                                <div class="col-md-3">
                                    <div class="order-info-item">
                                        <i class="fas fa-user text-muted me-2"></i>
                                        <span class="fw-medium" th:text="${order.customerName ?: order.customer?.fullName ?: 'Khách hàng'}">Khách hàng</span>
                                    </div>
                                    <div class="order-info-item">
                                        <i class="fas fa-phone text-muted me-2"></i>
                                        <span th:text="${order.customerPhone ?: order.customer?.phone ?: 'N/A'}">0123456789</span>
                                    </div>
                                </div>

                                <!-- Status & Payment -->
                                <div class="col-md-3">
                                    <div class="mb-2">
                                        <small class="text-muted d-block mb-1">Trạng thái đơn:</small>
                                        <span class="status-badge"
                                              th:classappend="${order.status == T(com.example.htql_nhahang_khachsan.enums.OrderStatus).PENDING ? 'bg-warning text-dark' :
                                                              order.status == T(com.example.htql_nhahang_khachsan.enums.OrderStatus).CONFIRMED ? 'bg-info' :
                                                              order.status == T(com.example.htql_nhahang_khachsan.enums.OrderStatus).PREPARING ? 'bg-primary' :
                                                              order.status == T(com.example.htql_nhahang_khachsan.enums.OrderStatus).READY ? 'bg-success' :
                                                              order.status == T(com.example.htql_nhahang_khachsan.enums.OrderStatus).COMPLETED ? 'bg-success' :
                                                              order.status == T(com.example.htql_nhahang_khachsan.enums.OrderStatus).CANCELLED ? 'bg-danger' : 'bg-secondary'}"
                                              th:text="${order.status}">
                                        </span>
                                    </div>
                                    <div>
                                        <small class="text-muted d-block mb-1">Thanh toán:</small>
                                        <span class="status-badge"
                                              th:classappend="${order.paymentStatus == T(com.example.htql_nhahang_khachsan.enums.PaymentStatus).PAID ? 'bg-success' :
                                                              order.paymentStatus == T(com.example.htql_nhahang_khachsan.enums.PaymentStatus).PENDING ? 'bg-warning text-dark' : 'bg-danger'}"
                                              th:text="${order.paymentStatus}">
                                        </span>
                                    </div>
                                </div>

                                <!-- Amount & Actions -->
                                <div class="col-md-3 text-end">
                                    <div class="mb-3">
                                        <small class="text-muted d-block">Tổng tiền:</small>
                                        <h5 class="text-primary fw-bold mb-0">
                                            <span th:text="${#numbers.formatDecimal(order.finalAmount, 0, 'COMMA', 0, 'POINT')}">0</span>đ
                                        </h5>
                                        <small class="text-muted" th:text="${order.paymentMethod}">CASH</small>
                                    </div>
                                    <a th:href="@{/manager/orders/{id}(id=${order.id})}"
                                       class="btn btn-sm btn-primary">
                                        <i class="fas fa-eye me-1"></i>Chi tiết
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>