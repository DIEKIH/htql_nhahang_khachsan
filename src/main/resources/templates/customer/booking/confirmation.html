<!--<!DOCTYPE html>-->
<!--<html lang="vi" xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--  <title>Xác nhận & Thanh toán - Bước 4</title>-->
<!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">-->
<!--  <style>-->
<!--    :root {-->
<!--      &#45;&#45;primary-color: #c9a96e;-->
<!--    }-->
<!--    body {-->
<!--      background: #f8f9fa;-->
<!--      padding-top: 80px;-->
<!--    }-->
<!--    .booking-steps {-->
<!--      background: white;-->
<!--      padding: 30px;-->
<!--      margin-bottom: 30px;-->
<!--      border-radius: 15px;-->
<!--      box-shadow: 0 5px 15px rgba(0,0,0,0.08);-->
<!--    }-->
<!--    .step {-->
<!--      display: flex;-->
<!--      flex-direction: column;-->
<!--      align-items: center;-->
<!--    }-->
<!--    .step-number {-->
<!--      width: 50px;-->
<!--      height: 50px;-->
<!--      border-radius: 50%;-->
<!--      background: #e9ecef;-->
<!--      display: flex;-->
<!--      align-items: center;-->
<!--      justify-content: center;-->
<!--      font-weight: bold;-->
<!--      margin-bottom: 10px;-->
<!--    }-->
<!--    .step.active .step-number {-->
<!--      background: var(&#45;&#45;primary-color);-->
<!--      color: white;-->
<!--    }-->
<!--    .step.completed .step-number {-->
<!--      background: #28a745;-->
<!--      color: white;-->
<!--    }-->
<!--    .booking-card {-->
<!--      background: white;-->
<!--      border-radius: 15px;-->
<!--      padding: 30px;-->
<!--      box-shadow: 0 5px 15px rgba(0,0,0,0.08);-->
<!--      margin-bottom: 20px;-->
<!--    }-->
<!--    .info-row {-->
<!--      display: flex;-->
<!--      justify-content: space-between;-->
<!--      padding: 10px 0;-->
<!--      border-bottom: 1px solid #f0f0f0;-->
<!--    }-->
<!--    .info-row:last-child {-->
<!--      border-bottom: none;-->
<!--    }-->
<!--    .payment-method {-->
<!--      border: 2px solid #e9ecef;-->
<!--      border-radius: 10px;-->
<!--      padding: 20px;-->
<!--      margin-bottom: 15px;-->
<!--      cursor: pointer;-->
<!--      transition: all 0.3s;-->
<!--    }-->
<!--    .payment-method:hover {-->
<!--      border-color: var(&#45;&#45;primary-color);-->
<!--    }-->
<!--    .payment-method.selected {-->
<!--      border-color: var(&#45;&#45;primary-color);-->
<!--      background: rgba(201, 169, 110, 0.05);-->
<!--    }-->
<!--    .payment-method input[type="radio"] {-->
<!--      cursor: pointer;-->
<!--    }-->
<!--    .payment-option {-->
<!--      border: 2px solid #e9ecef;-->
<!--      border-radius: 10px;-->
<!--      padding: 15px;-->
<!--      margin-bottom: 15px;-->
<!--      cursor: pointer;-->
<!--      transition: all 0.3s;-->
<!--    }-->
<!--    .payment-option:hover {-->
<!--      border-color: var(&#45;&#45;primary-color);-->
<!--    }-->
<!--    .payment-option.selected {-->
<!--      border-color: var(&#45;&#45;primary-color);-->
<!--      background: rgba(201, 169, 110, 0.05);-->
<!--    }-->
<!--    .btn-luxury {-->
<!--      background: var(&#45;&#45;primary-color);-->
<!--      color: white;-->
<!--      padding: 15px 40px;-->
<!--      border: none;-->
<!--      border-radius: 50px;-->
<!--      font-weight: 600;-->
<!--      font-size: 1.1rem;-->
<!--    }-->
<!--    .btn-luxury:hover {-->
<!--      background: #b8956b;-->
<!--      color: white;-->
<!--    }-->
<!--    .total-box {-->
<!--      background: linear-gradient(135deg, var(&#45;&#45;primary-color), #d4b079);-->
<!--      color: white;-->
<!--      padding: 25px;-->
<!--      border-radius: 15px;-->
<!--      text-align: center;-->
<!--    }-->
<!--    .total-amount {-->
<!--      font-size: 2rem;-->
<!--      font-weight: bold;-->
<!--      margin: 10px 0;-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--<div th:replace="fragments/user_navbar :: user_navbar"></div>-->

<!--<div class="container my-5">-->
<!--  &lt;!&ndash; Booking Steps &ndash;&gt;-->
<!--  <div class="booking-steps">-->
<!--    <div class="row">-->
<!--      <div class="col-md-3">-->
<!--        <div class="step completed">-->
<!--          <div class="step-number"><i class="fas fa-check"></i></div>-->
<!--          <div class="step-title">Chọn phòng</div>-->
<!--        </div>-->
<!--      </div>-->
<!--      <div class="col-md-3">-->
<!--        <div class="step completed">-->
<!--          <div class="step-number"><i class="fas fa-check"></i></div>-->
<!--          <div class="step-title">Dịch vụ</div>-->
<!--        </div>-->
<!--      </div>-->
<!--      <div class="col-md-3">-->
<!--        <div class="step completed">-->
<!--          <div class="step-number"><i class="fas fa-check"></i></div>-->
<!--          <div class="step-title">Thông tin</div>-->
<!--        </div>-->
<!--      </div>-->
<!--      <div class="col-md-3">-->
<!--        <div class="step active">-->
<!--          <div class="step-number">4</div>-->
<!--          <div class="step-title">Thanh toán</div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->

<!--  <div class="row">-->
<!--    <div class="col-lg-8">-->
<!--      &lt;!&ndash; Thông tin đặt phòng &ndash;&gt;-->
<!--      <div class="booking-card">-->
<!--        <h4><i class="fas fa-clipboard-check me-2"></i>Xác nhận thông tin đặt phòng</h4>-->
<!--        <hr>-->

<!--        <h6 class="text-primary mb-3">Thông tin phòng</h6>-->
<!--        <div class="info-row">-->
<!--          <span><strong>Loại phòng:</strong></span>-->
<!--          <span th:text="${bookingSession.roomType.name}">Deluxe Room</span>-->
<!--        </div>-->
<!--        <div class="info-row">-->
<!--          <span><strong>Chi nhánh:</strong></span>-->
<!--          <span th:text="${bookingSession.roomType.branchName}">Phú Quốc</span>-->
<!--        </div>-->
<!--        <div class="info-row">-->
<!--          <span><strong>Nhận phòng:</strong></span>-->
<!--          <span th:text="${#temporals.format(bookingSession.checkInDate, 'dd/MM/yyyy')}">15/12/2024</span>-->
<!--        </div>-->
<!--        <div class="info-row">-->
<!--          <span><strong>Trả phòng:</strong></span>-->
<!--          <span th:text="${#temporals.format(bookingSession.checkOutDate, 'dd/MM/yyyy')}">18/12/2024</span>-->
<!--        </div>-->
<!--        <div class="info-row">-->
<!--          <span><strong>Số đêm:</strong></span>-->
<!--          <span><span th:text="${bookingSession.numberOfNights}">3</span> đêm</span>-->
<!--        </div>-->
<!--        <div class="info-row">-->
<!--          <span><strong>Số phòng:</strong></span>-->
<!--          <span th:text="${bookingSession.numberOfRooms}">1</span>-->
<!--        </div>-->
<!--        <div class="info-row">-->
<!--          <span><strong>Khách:</strong></span>-->
<!--          <span>-->
<!--                            <span th:text="${bookingSession.adults}">2</span> người lớn-->
<!--                            <span th:if="${bookingSession.children > 0}" th:text="', ' + ${bookingSession.children} + ' trẻ em'"></span>-->
<!--                        </span>-->
<!--        </div>-->

<!--        <h6 class="text-primary mb-3 mt-4">Thông tin khách hàng</h6>-->
<!--        <div class="info-row">-->
<!--          <span><strong>Họ tên:</strong></span>-->
<!--          <span th:text="${bookingSession.guestName}">Nguyễn Văn A</span>-->
<!--        </div>-->
<!--        <div class="info-row">-->
<!--          <span><strong>Email:</strong></span>-->
<!--          <span th:text="${bookingSession.guestEmail}">email@example.com</span>-->
<!--        </div>-->
<!--        <div class="info-row">-->
<!--          <span><strong>Điện thoại:</strong></span>-->
<!--          <span th:text="${bookingSession.guestPhone}">0912345678</span>-->
<!--        </div>-->
<!--        <div class="info-row" th:if="${bookingSession.guestIdNumber}">-->
<!--          <span><strong>CMND/CCCD:</strong></span>-->
<!--          <span th:text="${bookingSession.guestIdNumber}">001234567890</span>-->
<!--        </div>-->
<!--        <div th:if="${bookingSession.specialRequests}" class="mt-3">-->
<!--          <strong>Yêu cầu đặc biệt:</strong>-->
<!--          <p class="text-muted mb-0 mt-2" th:text="${bookingSession.specialRequests}">Phòng tầng cao, view biển</p>-->
<!--        </div>-->

<!--        <div th:if="${bookingSession.includeBreakfast || bookingSession.includeSpa || bookingSession.includeAirportTransfer}">-->
<!--          <h6 class="text-primary mb-3 mt-4">Dịch vụ bổ sung</h6>-->
<!--          <div th:if="${bookingSession.includeBreakfast}" class="info-row">-->
<!--            <span><i class="fas fa-check text-success me-2"></i>Buffet sáng</span>-->
<!--            <span th:text="${#numbers.formatDecimal(bookingSession.breakfastFee, 0, 'COMMA', 0, 'POINT') + 'đ'}">600,000đ</span>-->
<!--          </div>-->
<!--          <div th:if="${bookingSession.includeSpa}" class="info-row">-->
<!--            <span><i class="fas fa-check text-success me-2"></i>Spa package</span>-->
<!--            <span th:text="${#numbers.formatDecimal(bookingSession.spaFee, 0, 'COMMA', 0, 'POINT') + 'đ'}">1,000,000đ</span>-->
<!--          </div>-->
<!--          <div th:if="${bookingSession.includeAirportTransfer}" class="info-row">-->
<!--            <span><i class="fas fa-check text-success me-2"></i>Đưa đón sân bay</span>-->
<!--            <span th:text="${#numbers.formatDecimal(bookingSession.airportTransferFee, 0, 'COMMA', 0, 'POINT') + 'đ'}">300,000đ</span>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; Chọn phương thức thanh toán &ndash;&gt;-->
<!--      <div class="booking-card">-->
<!--        <h4><i class="fas fa-credit-card me-2"></i>Phương thức thanh toán</h4>-->
<!--        <hr>-->

<!--        <form th:action="@{/bookings/complete}" method="post" id="paymentForm">-->
<!--          <input type="hidden" name="sessionId" th:value="${bookingSession.sessionId}">-->

<!--          &lt;!&ndash; Chọn thanh toán full hay đặt cọc &ndash;&gt;-->
<!--          <h6 class="mb-3">Chọn hình thức thanh toán</h6>-->

<!--          <div class="payment-option" onclick="selectPaymentType('full')">-->
<!--            <div class="form-check">-->
<!--              <input class="form-check-input" type="radio" name="isDepositOnly"-->
<!--                     id="fullPayment" value="false" checked>-->
<!--              <label class="form-check-label" for="fullPayment">-->
<!--                <strong>Thanh toán toàn bộ</strong>-->
<!--                <div class="text-muted mt-1">-->
<!--                  Thanh toán <span th:text="${#numbers.formatDecimal(bookingSession.totalAmount, 0, 'COMMA', 0, 'POINT') + 'đ'}">7,900,000đ</span>-->
<!--                </div>-->
<!--                <div class="text-success mt-1">-->
<!--                  <i class="fas fa-gift me-1"></i>Giảm thêm 2% khi thanh toán full-->
<!--                </div>-->
<!--              </label>-->
<!--            </div>-->
<!--          </div>-->

<!--          <div class="payment-option" onclick="selectPaymentType('deposit')">-->
<!--            <div class="form-check">-->
<!--              <input class="form-check-input" type="radio" name="isDepositOnly"-->
<!--                     id="depositPayment" value="true">-->
<!--              <label class="form-check-label" for="depositPayment">-->
<!--                <strong>Đặt cọc 50%</strong>-->
<!--                <div class="text-muted mt-1">-->
<!--                  Thanh toán <span th:text="${#numbers.formatDecimal(bookingSession.depositAmount, 0, 'COMMA', 0, 'POINT') + 'đ'}">3,950,000đ</span>-->
<!--                  ngay, phần còn lại thanh toán khi check-in-->
<!--                </div>-->
<!--                <div class="text-info mt-1">-->
<!--                  <i class="fas fa-info-circle me-1"></i>Số tiền còn lại:-->
<!--                  <span th:text="${#numbers.formatDecimal(bookingSession.remainingAmount, 0, 'COMMA', 0, 'POINT') + 'đ'}">3,950,000đ</span>-->
<!--                </div>-->
<!--              </label>-->
<!--            </div>-->
<!--          </div>-->

<!--          <hr class="my-4">-->

<!--          <h6 class="mb-3">Phương thức thanh toán</h6>-->

<!--&lt;!&ndash;          <div class="payment-method" onclick="selectPaymentMethod('VNPAY')">&ndash;&gt;-->
<!--&lt;!&ndash;            <div class="form-check">&ndash;&gt;-->
<!--&lt;!&ndash;              <input class="form-check-input" type="radio" name="paymentMethod"&ndash;&gt;-->
<!--&lt;!&ndash;                     id="vnpay" value="VNPAY" checked>&ndash;&gt;-->
<!--&lt;!&ndash;              <label class="form-check-label d-flex align-items-center" for="vnpay">&ndash;&gt;-->
<!--&lt;!&ndash;                <div class="me-3" style="width: 50px; height: 50px; background: #0088cc; border-radius: 10px; display: flex; align-items: center; justify-content: center;">&ndash;&gt;-->
<!--&lt;!&ndash;                  <i class="fas fa-wallet text-white fa-lg"></i>&ndash;&gt;-->
<!--&lt;!&ndash;                </div>&ndash;&gt;-->
<!--&lt;!&ndash;                <div>&ndash;&gt;-->
<!--&lt;!&ndash;                  <strong>VNPay</strong>&ndash;&gt;-->
<!--&lt;!&ndash;                  <div class="text-muted">Thanh toán qua VNPay, hỗ trợ nhiều ngân hàng</div>&ndash;&gt;-->
<!--&lt;!&ndash;                </div>&ndash;&gt;-->
<!--&lt;!&ndash;              </label>&ndash;&gt;-->
<!--&lt;!&ndash;            </div>&ndash;&gt;-->
<!--&lt;!&ndash;          </div>&ndash;&gt;-->

<!--          &lt;!&ndash; VNPay &ndash;&gt;-->
<!--          <div class="payment-method">-->
<!--            <div class="form-check">-->
<!--              <input class="form-check-input" type="radio" name="paymentMethod"-->
<!--                     id="vnpay" value="VNPAY" checked>-->
<!--              <label class="form-check-label d-flex align-items-center" for="vnpay">-->
<!--                <div class="me-3" style="width: 50px; height: 50px; background: #0088cc; border-radius: 10px; display: flex; align-items: center; justify-content: center;">-->
<!--                  <i class="fas fa-wallet text-white fa-lg"></i>-->
<!--                </div>-->
<!--                <div>-->
<!--                  <strong>VNPay</strong>-->
<!--                  <div class="text-muted">Thanh toán qua VNPay, hỗ trợ nhiều ngân hàng</div>-->
<!--                </div>-->
<!--              </label>-->
<!--            </div>-->
<!--          </div>-->

<!--          <div class="payment-method" onclick="selectPaymentMethod('BANK_TRANSFER')">-->
<!--            <div class="form-check">-->
<!--              <input class="form-check-input" type="radio" name="paymentMethod"-->
<!--                     id="bank" value="BANK_TRANSFER">-->
<!--              <label class="form-check-label d-flex align-items-center" for="bank">-->
<!--                <div class="me-3" style="width: 50px; height: 50px; background: #28a745; border-radius: 10px; display: flex; align-items: center; justify-content: center;">-->
<!--                  <i class="fas fa-university text-white fa-lg"></i>-->
<!--                </div>-->
<!--                <div>-->
<!--                  <strong>Chuyển khoản ngân hàng</strong>-->
<!--                  <div class="text-muted">Chuyển khoản trực tiếp qua ngân hàng</div>-->
<!--                </div>-->
<!--              </label>-->
<!--            </div>-->
<!--          </div>-->

<!--          <div class="payment-method" onclick="selectPaymentMethod('CREDIT_CARD')">-->
<!--            <div class="form-check">-->
<!--              <input class="form-check-input" type="radio" name="paymentMethod"-->
<!--                     id="credit" value="CREDIT_CARD">-->
<!--              <label class="form-check-label d-flex align-items-center" for="credit">-->
<!--                <div class="me-3" style="width: 50px; height: 50px; background: var(&#45;&#45;primary-color); border-radius: 10px; display: flex; align-items: center; justify-content: center;">-->
<!--                  <i class="fas fa-credit-card text-white fa-lg"></i>-->
<!--                </div>-->
<!--                <div>-->
<!--                  <strong>Thẻ tín dụng / Ghi nợ</strong>-->
<!--                  <div class="text-muted">Visa, Mastercard, JCB</div>-->
<!--                </div>-->
<!--              </label>-->
<!--            </div>-->
<!--          </div>-->

<!--          <div class="alert alert-warning mt-4">-->
<!--            <i class="fas fa-exclamation-triangle me-2"></i>-->
<!--            <strong>Chính sách hủy phòng:</strong>-->
<!--            <ul class="mb-0 mt-2">-->
<!--              <li>Miễn phí hủy trước 24 giờ so với giờ check-in</li>-->
<!--              <li>Hủy trong vòng 24 giờ: Tính phí 50% tổng hóa đơn</li>-->
<!--              <li>No-show (không đến): Tính 100% phí phòng</li>-->
<!--            </ul>-->
<!--          </div>-->

<!--          <div class="form-check mt-4">-->
<!--            <input class="form-check-input" type="checkbox" id="agreeTerms" required>-->
<!--            <label class="form-check-label" for="agreeTerms">-->
<!--              Tôi đã đọc và đồng ý với <a href="#">Điều khoản & Điều kiện</a> và-->
<!--              <a href="#">Chính sách hủy phòng</a>-->
<!--            </label>-->
<!--          </div>-->

<!--          <div class="d-flex gap-2 mt-4">-->
<!--&lt;!&ndash;            <button type="button" class="btn btn-outline-secondary"&ndash;&gt;-->
<!--&lt;!&ndash;                    th:onclick="|location.href='@{/bookings/guest-info/{id}(id=${bookingSession.sessionId})}'|">&ndash;&gt;-->
<!--&lt;!&ndash;              <i class="fas fa-arrow-left me-2"></i>Quay lại&ndash;&gt;-->
<!--&lt;!&ndash;            </button>&ndash;&gt;-->

<!--            <a th:href="@{/bookings/guest-info/{id}(id=${bookingSession.sessionId})}"-->
<!--               class="btn btn-outline-secondary">-->
<!--              <i class="fas fa-arrow-left me-2"></i>Quay lại-->
<!--            </a>-->

<!--            <button type="submit" class="btn btn-luxury flex-grow-1" id="submitBtn">-->
<!--              <i class="fas fa-lock me-2"></i>Xác nhận và thanh toán-->
<!--            </button>-->
<!--          </div>-->
<!--        </form>-->
<!--      </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Summary Sidebar &ndash;&gt;-->
<!--    <div class="col-lg-4">-->
<!--      <div class="booking-card" style="position: sticky; top: 100px;">-->
<!--        <div class="total-box">-->
<!--          <h6 class="mb-2">Tổng thanh toán</h6>-->
<!--          <div class="total-amount" id="displayAmount"-->
<!--               th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.totalAmount, 0, 'COMMA', 0, 'POINT'), ' đ')}">-->
<!--            7,900,000 đ-->
<!--          </div>-->
<!--          <small id="paymentNote">Thanh toán toàn bộ</small>-->
<!--        </div>-->

<!--        <hr>-->

<!--        <h6 class="mb-3">Chi tiết giá</h6>-->
<!--        <div class="info-row">-->
<!--          <span>Giá phòng x <span th:text="${bookingSession.numberOfNights}">3</span> đêm</span>-->
<!--          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.totalRoomPrice, 0, 'COMMA', 0, 'POINT'), ' đ')}">5,400,000 đ</span>-->
<!--        </div>-->
<!--        <div class="info-row" th:if="${bookingSession.includeBreakfast}">-->
<!--          <span>Buffet sáng</span>-->
<!--          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.breakfastFee, 0, 'COMMA', 0, 'POINT'), ' đ')}">600,000 đ</span>-->
<!--        </div>-->
<!--        <div class="info-row" th:if="${bookingSession.includeSpa}">-->
<!--          <span>Spa package</span>-->
<!--          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.spaFee, 0, 'COMMA', 0, 'POINT'), ' đ')}">1,000,000 đ</span>-->
<!--        </div>-->
<!--        <div class="info-row" th:if="${bookingSession.includeAirportTransfer}">-->
<!--          <span>Đưa đón sân bay</span>-->
<!--          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.airportTransferFee, 0, 'COMMA', 0, 'POINT'), ' đ')}">300,000 đ</span>-->
<!--        </div>-->
<!--        <div class="info-row">-->
<!--          <span>Phí dịch vụ (10%)</span>-->
<!--          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.serviceFee, 0, 'COMMA', 0, 'POINT'), ' đ')}">540,000 đ</span>-->
<!--        </div>-->
<!--        <div class="info-row">-->
<!--          <span>VAT (10%)</span>-->
<!--          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.vat, 0, 'COMMA', 0, 'POINT'), ' đ')}">594,000 đ</span>-->
<!--        </div>-->

<!--        <div class="alert alert-success mt-3 mb-0">-->
<!--          <i class="fas fa-shield-alt me-2"></i>-->
<!--          <strong>Thanh toán an toàn</strong>-->
<!--          <div class="mt-1">Giao dịch được mã hóa SSL 256-bit</div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--  </div>-->
<!--</div>-->

<!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>-->
<!--<script th:inline="javascript">-->
<!--  const totalAmount = /*[[${bookingSession.totalAmount}]]*/ 0;-->
<!--  const depositAmount = /*[[${bookingSession.depositAmount}]]*/ 0;-->

<!--  // Toggle chọn payment method-->
<!--  document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {-->
<!--    radio.addEventListener('change', function() {-->
<!--      document.querySelectorAll('.payment-method').forEach(pm => {-->
<!--        pm.classList.remove('selected');-->
<!--      });-->
<!--      this.closest('.payment-method').classList.add('selected');-->
<!--    });-->
<!--  });-->

<!--  // Hàm chọn kiểu thanh toán (full / deposit)-->
<!--  function selectPaymentType(type) {-->
<!--    const fullRadio = document.getElementById('fullPayment');-->
<!--    const depositRadio = document.getElementById('depositPayment');-->

<!--    if (type === 'full') {-->
<!--      fullRadio.checked = true;-->
<!--      updateDisplayAmount(totalAmount, 'Thanh toán toàn bộ');-->
<!--    } else {-->
<!--      depositRadio.checked = true;-->
<!--      updateDisplayAmount(depositAmount, 'Đặt cọc 50% - Còn lại thanh toán khi check-in');-->
<!--    }-->
<!--  }-->

<!--  // Hàm chọn phương thức thanh toán (momo, vnpay, ...)-->
<!--  function selectPaymentMethod(method) {-->
<!--    document.querySelectorAll('.payment-method').forEach(pm => {-->
<!--      pm.classList.remove('selected');-->
<!--    });-->

<!--    const selectedMethod = document.querySelector(`input[value="${method}"]`);-->
<!--    selectedMethod.checked = true;-->
<!--    selectedMethod.closest('.payment-method').classList.add('selected');-->
<!--  }-->

<!--  // Cập nhật số tiền hiển thị-->
<!--  function updateDisplayAmount(amount, note) {-->
<!--    document.getElementById('displayAmount').textContent = formatCurrency(amount);-->
<!--    document.getElementById('paymentNote').textContent = note;-->
<!--  }-->

<!--  // Định dạng tiền VNĐ-->
<!--  function formatCurrency(amount) {-->
<!--    return new Intl.NumberFormat('vi-VN').format(amount) + ' đ'; // thêm khoảng trắng-->
<!--  }-->

<!--  // Event listener khi đổi loại thanh toán-->
<!--  document.getElementById('fullPayment').addEventListener('change', function() {-->
<!--    if (this.checked) {-->
<!--      updateDisplayAmount(totalAmount, 'Thanh toán toàn bộ');-->
<!--    }-->
<!--  });-->

<!--  document.getElementById('depositPayment').addEventListener('change', function() {-->
<!--    if (this.checked) {-->
<!--      updateDisplayAmount(depositAmount, 'Đặt cọc 50% - Còn lại thanh toán khi check-in');-->
<!--    }-->
<!--  });-->

<!--  // Form submission-->
<!--  document.getElementById('paymentForm').addEventListener('submit', function(e) {-->
<!--    const agreeTerms = document.getElementById('agreeTerms');-->
<!--    if (!agreeTerms.checked) {-->
<!--      e.preventDefault();-->
<!--      alert('Vui lòng đồng ý với điều khoản và điều kiện để tiếp tục.');-->
<!--      return false;-->
<!--    }-->

<!--    // Confirm trước khi submit-->
<!--    const isDepositOnly = document.getElementById('depositPayment').checked;-->
<!--    const amount = isDepositOnly ? depositAmount : totalAmount;-->
<!--    const amountFormatted = formatCurrency(amount);-->

<!--    if (!confirm(`Xác nhận thanh toán ${amountFormatted}?`)) {-->
<!--      e.preventDefault();-->
<!--      return false;-->
<!--    }-->

<!--    // Show loading state-->
<!--    const submitBtn = document.getElementById('submitBtn');-->
<!--    submitBtn.disabled = true;-->
<!--    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Đang xử lý thanh toán...';-->

<!--    // ✅ QUAN TRỌNG: Không preventDefault nữa, để form tự submit-->
<!--    // Đã xác nhận rồi thì cho phép submit-->
<!--  });-->

<!--  // Initialize-->
<!--  document.addEventListener('DOMContentLoaded', function() {-->
<!--    // Set default selected payment method theo radio đang check-->
<!--    const checkedMethod = document.querySelector('input[name="paymentMethod"]:checked');-->
<!--    if (checkedMethod) {-->
<!--      checkedMethod.closest('.payment-method').classList.add('selected');-->
<!--    }-->
<!--  });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Xác nhận & Thanh toán - Bước 4</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #c9a96e;
      --scale: 0.75;
    }

    * {
      box-sizing: border-box;
    }

    body {
      background: #f8f9fa;
      padding-top: 60px;
      font-size: 12px;
      line-height: 1.4;
    }

    .container {
      max-width: 990px;
      padding-left: 11.25px;
      padding-right: 11.25px;
    }

    /* Booking Steps */
    .booking-steps {
      background: white;
      padding: 22.5px;
      margin-bottom: 22.5px;
      border-radius: 11.25px;
      box-shadow: 0 3.75px 11.25px rgba(0,0,0,0.06);
    }

    .booking-steps .row {
      margin-left: -7.5px;
      margin-right: -7.5px;
    }

    .booking-steps [class*="col-"] {
      padding-left: 7.5px;
      padding-right: 7.5px;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .step-number {
      width: 37.5px;
      height: 37.5px;
      border-radius: 50%;
      background: #e9ecef;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-bottom: 7.5px;
      font-size: 11px;
    }

    .step.active .step-number {
      background: var(--primary-color);
      color: white;
    }

    .step.completed .step-number {
      background: #28a745;
      color: white;
    }

    .step-title {
      font-size: 10.5px;
      text-align: center;
    }

    /* Main row */
    .main-row {
      margin-left: -7.5px;
      margin-right: -7.5px;
    }

    .main-row > [class*="col-"] {
      padding-left: 7.5px;
      padding-right: 7.5px;
    }

    /* Booking Card */
    .booking-card {
      background: white;
      border-radius: 11.25px;
      padding: 22.5px;
      box-shadow: 0 3.75px 11.25px rgba(0,0,0,0.06);
      margin-bottom: 15px;
    }

    .booking-card h4 {
      font-size: 14px;
      margin-bottom: 9px;
      font-weight: 600;
    }

    .booking-card h5 {
      font-size: 13px;
      margin-bottom: 9px;
      font-weight: 600;
    }

    .booking-card h6 {
      font-size: 11.5px;
      margin-bottom: 9px;
      font-weight: 600;
      color: var(--primary-color);
    }

    .booking-card hr {
      margin: 11.25px 0;
      opacity: 0.1;
    }

    /* Info Row */
    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 7.5px 0;
      border-bottom: 1px solid #f0f0f0;
      font-size: 11px;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    /* Payment Method */
    .payment-method {
      border: 1.5px solid #e9ecef;
      border-radius: 7.5px;
      padding: 15px;
      margin-bottom: 11.25px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .payment-method:hover {
      border-color: var(--primary-color);
      transform: translateY(-1px);
    }

    .payment-method.selected {
      border-color: var(--primary-color);
      background: rgba(201, 169, 110, 0.05);
    }

    .payment-method input[type="radio"] {
      cursor: pointer;
      width: 15px;
      height: 15px;
      margin-top: 1.5px;
    }

    .payment-method .form-check {
      margin-bottom: 0;
      padding-left: 22.5px;
    }

    .payment-method .form-check-input {
      margin-left: -22.5px;
    }

    .payment-method .icon-box {
      width: 37.5px !important;
      height: 37.5px !important;
      border-radius: 7.5px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    /* Payment Option */
    .payment-option {
      border: 1.5px solid #e9ecef;
      border-radius: 7.5px;
      padding: 11.25px;
      margin-bottom: 11.25px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .payment-option:hover {
      border-color: var(--primary-color);
      transform: translateY(-1px);
    }

    .payment-option.selected {
      border-color: var(--primary-color);
      background: rgba(201, 169, 110, 0.05);
    }

    .payment-option .form-check {
      margin-bottom: 0;
      padding-left: 22.5px;
    }

    .payment-option .form-check-input {
      width: 15px;
      height: 15px;
      margin-top: 1.5px;
      margin-left: -22.5px;
    }

    /* Buttons */
    .btn-luxury {
      background: var(--primary-color);
      color: white;
      padding: 11.25px 30px;
      border: none;
      border-radius: 37.5px;
      font-weight: 600;
      font-size: 12.5px;
      transition: all 0.3s;
    }

    .btn-luxury:hover {
      background: #b8956b;
      color: white;
      transform: translateY(-1.5px);
    }

    .btn-outline-secondary {
      padding: 11.25px 30px;
      font-size: 12.5px;
      border-radius: 37.5px;
      border: 1px solid #6c757d;
      color: #6c757d;
      background: white;
      font-weight: 500;
      transition: all 0.3s;
      text-decoration: none;
    }

    .btn-outline-secondary:hover {
      background: #6c757d;
      color: white;
    }

    /* Total Box */
    .total-box {
      background: linear-gradient(135deg, var(--primary-color), #d4b079);
      color: white;
      padding: 18.75px;
      border-radius: 11.25px;
      text-align: center;
    }

    .total-box h6 {
      font-size: 11px;
      margin-bottom: 7.5px;
      color: white;
    }

    .total-amount {
      font-size: 21px;
      font-weight: bold;
      margin: 7.5px 0;
    }

    .total-box small {
      font-size: 9px;
    }

    /* Alert */
    .alert {
      padding: 9px 12px;
      font-size: 10.5px;
      border-radius: 6px;
      margin-bottom: 0;
    }

    .alert ul {
      margin-bottom: 0;
      padding-left: 15px;
      margin-top: 6px;
    }

    .alert li {
      margin-bottom: 3px;
    }

    .alert-warning {
      background-color: #fff3cd;
      border-color: #ffecb5;
      color: #856404;
    }

    .alert-success {
      background-color: #d1e7dd;
      border-color: #badbcc;
      color: #0f5132;
    }

    .alert-info {
      background-color: #cff4fc;
      border-color: #b6effb;
      color: #055160;
    }

    /* Form check */
    .form-check {
      padding-left: 22.5px;
    }

    .form-check-input {
      width: 15px;
      height: 15px;
      margin-top: 1.5px;
      margin-left: -22.5px;
    }

    .form-check-label {
      font-size: 11px;
    }

    .form-check-label a {
      color: var(--primary-color);
      text-decoration: none;
    }

    .form-check-label a:hover {
      text-decoration: underline;
    }

    /* Sticky sidebar */
    .sticky-sidebar {
      position: sticky;
      top: 75px;
    }

    /* Grid gap */
    .d-flex.gap-2 {
      gap: 7.5px !important;
    }

    /* Icons */
    .fa, .fas {
      font-size: 10px;
    }

    .fa-lg {
      font-size: 14px !important;
    }

    .me-1 {
      margin-right: 3px !important;
    }

    .me-2 {
      margin-right: 6px !important;
    }

    .me-3 {
      margin-right: 9px !important;
    }

    .my-4 {
      margin-top: 12px !important;
      margin-bottom: 12px !important;
    }

    .my-5 {
      margin-top: 15px !important;
      margin-bottom: 15px !important;
    }

    .mt-1 {
      margin-top: 3px !important;
    }

    .mt-2 {
      margin-top: 6px !important;
    }

    .mt-3 {
      margin-top: 9px !important;
    }

    .mt-4 {
      margin-top: 12px !important;
    }

    .mb-0 {
      margin-bottom: 0 !important;
    }

    .mb-2 {
      margin-bottom: 6px !important;
    }

    .mb-3 {
      margin-bottom: 9px !important;
    }

    /* Text utilities */
    .text-muted {
      color: #6c757d !important;
      font-size: 10px;
    }

    .text-primary {
      color: var(--primary-color) !important;
    }

    .text-success {
      color: #28a745 !important;
    }

    .text-info {
      color: #0dcaf0 !important;
    }

    small {
      font-size: 9.5px;
    }

    strong {
      font-weight: 600;
    }

    /* Flex utilities */
    .flex-grow-1 {
      flex-grow: 1 !important;
    }

    .d-flex {
      display: flex !important;
    }

    .align-items-center {
      align-items: center !important;
    }

    .justify-content-between {
      justify-content: space-between !important;
    }

    /* Responsive */
    @media (max-width: 1400px) {
      .container {
        max-width: 855px;
      }
    }

    @media (max-width: 1200px) {
      body {
        font-size: 11px;
      }

      .booking-card {
        padding: 18px 20px;
      }
    }

    @media (max-width: 992px) {
      .sticky-sidebar {
        position: static;
        margin-top: 15px;
      }

      .container {
        max-width: 540px;
      }
    }

    @media (max-width: 768px) {
      body {
        padding-top: 52.5px;
        font-size: 10px;
      }

      .container {
        max-width: 405px;
      }

      .booking-steps {
        padding: 15px;
      }

      .step-number {
        width: 33px;
        height: 33px;
        font-size: 10px;
      }

      .step-title {
        font-size: 9px;
      }

      .total-amount {
        font-size: 18px;
      }
    }

    @media (max-width: 576px) {
      .container {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
<div th:replace="fragments/user_navbar :: user_navbar"></div>

<div class="container my-5">
  <!-- Booking Steps -->
  <div class="booking-steps">
    <div class="row">
      <div class="col-md-3">
        <div class="step completed">
          <div class="step-number"><i class="fas fa-check"></i></div>
          <div class="step-title">Chọn phòng</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="step completed">
          <div class="step-number"><i class="fas fa-check"></i></div>
          <div class="step-title">Dịch vụ</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="step completed">
          <div class="step-number"><i class="fas fa-check"></i></div>
          <div class="step-title">Thông tin</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="step active">
          <div class="step-number">4</div>
          <div class="step-title">Thanh toán</div>
        </div>
      </div>
    </div>
  </div>

  <div class="row main-row">
    <div class="col-lg-8">
      <!-- Thông tin đặt phòng -->
      <div class="booking-card">
        <h4><i class="fas fa-clipboard-check me-2"></i>Xác nhận thông tin đặt phòng</h4>
        <hr>

        <h6 class="mb-3">Thông tin phòng</h6>
        <div class="info-row">
          <span><strong>Loại phòng:</strong></span>
          <span th:text="${bookingSession.roomType.name}">Deluxe Room</span>
        </div>
        <div class="info-row">
          <span><strong>Chi nhánh:</strong></span>
          <span th:text="${bookingSession.roomType.branchName}">Phú Quốc</span>
        </div>
        <div class="info-row">
          <span><strong>Nhận phòng:</strong></span>
          <span th:text="${#temporals.format(bookingSession.checkInDate, 'dd/MM/yyyy')}">15/12/2024</span>
        </div>
        <div class="info-row">
          <span><strong>Trả phòng:</strong></span>
          <span th:text="${#temporals.format(bookingSession.checkOutDate, 'dd/MM/yyyy')}">18/12/2024</span>
        </div>
        <div class="info-row">
          <span><strong>Số đêm:</strong></span>
          <span><span th:text="${bookingSession.numberOfNights}">3</span> đêm</span>
        </div>
        <div class="info-row">
          <span><strong>Số phòng:</strong></span>
          <span th:text="${bookingSession.numberOfRooms}">1</span>
        </div>
        <div class="info-row">
          <span><strong>Khách:</strong></span>
          <span>
            <span th:text="${bookingSession.adults}">2</span> người lớn
            <span th:if="${bookingSession.children > 0}" th:text="', ' + ${bookingSession.children} + ' trẻ em'"></span>
          </span>
        </div>

        <h6 class="mb-3 mt-4">Thông tin khách hàng</h6>
        <div class="info-row">
          <span><strong>Họ tên:</strong></span>
          <span th:text="${bookingSession.guestName}">Nguyễn Văn A</span>
        </div>
        <div class="info-row">
          <span><strong>Email:</strong></span>
          <span th:text="${bookingSession.guestEmail}">email@example.com</span>
        </div>
        <div class="info-row">
          <span><strong>Điện thoại:</strong></span>
          <span th:text="${bookingSession.guestPhone}">0912345678</span>
        </div>
        <div class="info-row" th:if="${bookingSession.guestIdNumber}">
          <span><strong>CMND/CCCD:</strong></span>
          <span th:text="${bookingSession.guestIdNumber}">001234567890</span>
        </div>
        <div th:if="${bookingSession.specialRequests}" class="mt-3">
          <strong>Yêu cầu đặc biệt:</strong>
          <p class="text-muted mb-0 mt-2" th:text="${bookingSession.specialRequests}">Phòng tầng cao, view biển</p>
        </div>

        <div th:if="${bookingSession.includeBreakfast || bookingSession.includeSpa || bookingSession.includeAirportTransfer}">
          <h6 class="mb-3 mt-4">Dịch vụ bổ sung</h6>
          <div th:if="${bookingSession.includeBreakfast}" class="info-row">
            <span><i class="fas fa-check text-success me-2"></i>Buffet sáng</span>
            <span th:text="${#numbers.formatDecimal(bookingSession.breakfastFee, 0, 'COMMA', 0, 'POINT') + 'đ'}">600,000đ</span>
          </div>
          <div th:if="${bookingSession.includeSpa}" class="info-row">
            <span><i class="fas fa-check text-success me-2"></i>Spa package</span>
            <span th:text="${#numbers.formatDecimal(bookingSession.spaFee, 0, 'COMMA', 0, 'POINT') + 'đ'}">1,000,000đ</span>
          </div>
          <div th:if="${bookingSession.includeAirportTransfer}" class="info-row">
            <span><i class="fas fa-check text-success me-2"></i>Đưa đón sân bay</span>
            <span th:text="${#numbers.formatDecimal(bookingSession.airportTransferFee, 0, 'COMMA', 0, 'POINT') + 'đ'}">300,000đ</span>
          </div>
        </div>
      </div>

      <!-- Chọn phương thức thanh toán -->
      <div class="booking-card">
        <h4><i class="fas fa-credit-card me-2"></i>Phương thức thanh toán</h4>
        <hr>

        <form th:action="@{/bookings/complete}" method="post" id="paymentForm">
          <input type="hidden" name="sessionId" th:value="${bookingSession.sessionId}">

          <!-- Chọn thanh toán full hay đặt cọc -->
          <h6 class="mb-3">Chọn hình thức thanh toán</h6>

<!--          <div class="payment-option" onclick="selectPaymentType('full')">-->
<!--            <div class="form-check">-->
<!--              <input class="form-check-input" type="radio" name="isDepositOnly"-->
<!--                     id="fullPayment" value="false" checked>-->
<!--              <label class="form-check-label" for="fullPayment">-->
<!--                <strong>Thanh toán toàn bộ</strong>-->
<!--                <div class="text-muted mt-1">-->
<!--                  Thanh toán <span th:text="${#numbers.formatDecimal(bookingSession.totalAmount, 0, 'COMMA', 0, 'POINT') + 'đ'}">7,900,000đ</span>-->
<!--                </div>-->
<!--                <div class="text-success mt-1">-->
<!--                  <i class="fas fa-gift me-1"></i>Giảm thêm 2% khi thanh toán full-->
<!--                </div>-->
<!--              </label>-->
<!--            </div>-->
<!--          </div>-->

<!--          <div class="payment-option" onclick="selectPaymentType('deposit')">-->
<!--            <div class="form-check">-->
<!--              <input class="form-check-input" type="radio" name="isDepositOnly"-->
<!--                     id="depositPayment" value="true">-->
<!--              <label class="form-check-label" for="depositPayment">-->
<!--                <strong>Đặt cọc 50%</strong>-->
<!--                <div class="text-muted mt-1">-->
<!--                  Thanh toán <span th:text="${#numbers.formatDecimal(bookingSession.depositAmount, 0, 'COMMA', 0, 'POINT') + 'đ'}">3,950,000đ</span>-->
<!--                  ngay, phần còn lại thanh toán khi check-in-->
<!--                </div>-->
<!--                <div class="text-info mt-1">-->
<!--                  <i class="fas fa-info-circle me-1"></i>Số tiền còn lại:-->
<!--                  <span th:text="${#numbers.formatDecimal(bookingSession.remainingAmount, 0, 'COMMA', 0, 'POINT') + 'đ'}">3,950,000đ</span>-->
<!--                </div>-->
<!--              </label>-->
<!--            </div>-->
<!--          </div>-->

          <div class="payment-option" onclick="selectPaymentType('full', event)">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="isDepositOnly"
                     id="fullPayment" value="false" checked>
              <label class="form-check-label" for="fullPayment">
                <strong>Thanh toán toàn bộ</strong>
                <div class="text-muted mt-1">
                  Thanh toán
                  <span th:text="${#numbers.formatDecimal(bookingSession.totalAmount, 0, 'COMMA', 0, 'POINT') + 'đ'}">7,900,000đ</span>
                </div>
                <div class="text-success mt-1">
                  <i class="fas fa-gift me-1"></i>Giảm thêm 2% khi thanh toán full
                </div>
              </label>
            </div>
          </div>

          <div class="payment-option" onclick="selectPaymentType('deposit', event)">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="isDepositOnly"
                     id="depositPayment" value="true">
              <label class="form-check-label" for="depositPayment">
                <strong>Đặt cọc 50%</strong>
                <div class="text-muted mt-1">
                  Thanh toán
                  <span th:text="${#numbers.formatDecimal(bookingSession.depositAmount, 0, 'COMMA', 0, 'POINT') + 'đ'}">3,950,000đ</span>
                  ngay, phần còn lại thanh toán khi check-in
                </div>
                <div class="text-info mt-1">
                  <i class="fas fa-info-circle me-1"></i>Số tiền còn lại:
                  <span th:text="${#numbers.formatDecimal(bookingSession.remainingAmount, 0, 'COMMA', 0, 'POINT') + 'đ'}">3,950,000đ</span>
                </div>
              </label>
            </div>
          </div>

          <hr class="my-4">

          <h6 class="mb-3">Phương thức thanh toán</h6>

          <!-- VNPay -->
          <div class="payment-method">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="paymentMethod"
                     id="vnpay" value="VNPAY" checked>
              <label class="form-check-label d-flex align-items-center" for="vnpay">
                <div class="icon-box me-3" style="background: #0088cc;">
                  <i class="fas fa-wallet text-white fa-lg"></i>
                </div>
                <div>
                  <strong>VNPay</strong>
                  <div class="text-muted">Thanh toán qua VNPay, hỗ trợ nhiều ngân hàng</div>
                </div>
              </label>
            </div>
          </div>

          <div class="payment-method" onclick="selectPaymentMethod('BANK_TRANSFER')">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="paymentMethod"
                     id="bank" value="BANK_TRANSFER">
              <label class="form-check-label d-flex align-items-center" for="bank">
                <div class="icon-box me-3" style="background: #28a745;">
                  <i class="fas fa-university text-white fa-lg"></i>
                </div>
                <div>
                  <strong>Chuyển khoản ngân hàng</strong>
                  <div class="text-muted">Chuyển khoản trực tiếp qua ngân hàng</div>
                </div>
              </label>
            </div>
          </div>

          <div class="payment-method" onclick="selectPaymentMethod('CREDIT_CARD')">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="paymentMethod"
                     id="credit" value="CREDIT_CARD">
              <label class="form-check-label d-flex align-items-center" for="credit">
                <div class="icon-box me-3" style="background: var(--primary-color);">
                  <i class="fas fa-credit-card text-white fa-lg"></i>
                </div>
                <div>
                  <strong>Thẻ tín dụng / Ghi nợ</strong>
                  <div class="text-muted">Visa, Mastercard, JCB</div>
                </div>
              </label>
            </div>
          </div>

          <div class="alert alert-warning mt-4">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Chính sách hủy phòng:</strong>
            <ul>
              <li>Miễn phí hủy trước 24 giờ so với giờ check-in</li>
              <li>Hủy trong vòng 24 giờ: Tính phí 50% tổng hóa đơn</li>
              <li>No-show (không đến): Tính 100% phí phòng</li>
            </ul>
          </div>

          <div class="form-check mt-4">
            <input class="form-check-input" type="checkbox" id="agreeTerms" required>
            <label class="form-check-label" for="agreeTerms">
              Tôi đã đọc và đồng ý với <a href="#">Điều khoản & Điều kiện</a> và
              <a href="#">Chính sách hủy phòng</a>
            </label>
          </div>

          <div class="d-flex gap-2 mt-4">
            <a th:href="@{/bookings/guest-info/{id}(id=${bookingSession.sessionId})}"
               class="btn btn-outline-secondary">
              <i class="fas fa-arrow-left me-2"></i>Quay lại
            </a>

            <button type="submit" class="btn btn-luxury flex-grow-1" id="submitBtn">
              <i class="fas fa-lock me-2"></i>Xác nhận và thanh toán
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Summary Sidebar -->
    <div class="col-lg-4">
      <div class="booking-card sticky-sidebar">
        <div class="total-box">
          <h6 class="mb-2">Tổng thanh toán</h6>
          <div class="total-amount" id="displayAmount"
               th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.totalAmount, 0, 'COMMA', 0, 'POINT'), ' đ')}">
            7,900,000 đ
          </div>
          <small id="paymentNote">Thanh toán toàn bộ</small>
        </div>

        <hr>

        <h6 class="mb-3">Chi tiết giá</h6>
        <div class="info-row">
          <span>Giá phòng x <span th:text="${bookingSession.numberOfNights}">3</span> đêm</span>
          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.totalRoomPrice, 0, 'COMMA', 0, 'POINT'), ' đ')}">5,400,000 đ</span>
        </div>
        <div class="info-row" th:if="${bookingSession.includeBreakfast}">
          <span>Buffet sáng</span>
          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.breakfastFee, 0, 'COMMA', 0, 'POINT'), ' đ')}">600,000 đ</span>
        </div>
        <div class="info-row" th:if="${bookingSession.includeSpa}">
          <span>Spa package</span>
          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.spaFee, 0, 'COMMA', 0, 'POINT'), ' đ')}">1,000,000 đ</span>
        </div>
        <div class="info-row" th:if="${bookingSession.includeAirportTransfer}">
          <span>Đưa đón sân bay</span>
          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.airportTransferFee, 0, 'COMMA', 0, 'POINT'), ' đ')}">300,000 đ</span>
        </div>
        <div class="info-row">
          <span>Phí dịch vụ (10%)</span>
          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.serviceFee, 0, 'COMMA', 0, 'POINT'), ' đ')}">540,000 đ</span>
        </div>
        <div class="info-row">
          <span>VAT (10%)</span>
          <span th:text="${#strings.concat(#numbers.formatDecimal(bookingSession.vat, 0, 'COMMA', 0, 'POINT'), ' đ')}">594,000 đ</span>
        </div>

        <div class="alert alert-success mt-3">
          <i class="fas fa-shield-alt me-2"></i>
          <strong>Thanh toán an toàn</strong>
          <div class="mt-1">Giao dịch được mã hóa SSL 256-bit</div>
        </div>
      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
  const totalAmount = /*[[${bookingSession.totalAmount}]]*/ 0;
  const depositAmount = /*[[${bookingSession.depositAmount}]]*/ 0;

  // Toggle chọn payment method
  document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
    radio.addEventListener('change', function() {
      document.querySelectorAll('.payment-method').forEach(pm => {
        pm.classList.remove('selected');
      });
      this.closest('.payment-method').classList.add('selected');
    });
  });

  // Hàm chọn kiểu thanh toán (full / deposit)
  // function selectPaymentType(type) {
  //   const fullRadio = document.getElementById('fullPayment');
  //   const depositRadio = document.getElementById('depositPayment');
  //
  //   if (type === 'full') {
  //     fullRadio.checked = true;
  //     updateDisplayAmount(totalAmount, 'Thanh toán toàn bộ');
  //   } else {
  //     depositRadio.checked = true;
  //     updateDisplayAmount(depositAmount, 'Đặt cọc 50% - Còn lại thanh toán khi check-in');
  //   }
  // }

  function selectPaymentType(type, event) {
    event.stopPropagation(); // tránh click trùng radio
    const fullRadio = document.getElementById('fullPayment');
    const depositRadio = document.getElementById('depositPayment');
    const summary = document.getElementById('payment-summary');

    if (type === 'full') {
      fullRadio.checked = true;
      summary.innerText = `Thanh toán toàn bộ: ${totalAmount.toLocaleString()}đ (Giảm thêm 2%)`;
    } else {
      depositRadio.checked = true;
      summary.innerText = `Đặt cọc 50%: ${depositAmount.toLocaleString()}đ – Còn lại khi check-in`;
    }
  }

  // Hàm chọn phương thức thanh toán (momo, vnpay, ...)
  function selectPaymentMethod(method) {
    document.querySelectorAll('.payment-method').forEach(pm => {
      pm.classList.remove('selected');
    });

    const selectedMethod = document.querySelector(`input[value="${method}"]`);
    selectedMethod.checked = true;
    selectedMethod.closest('.payment-method').classList.add('selected');
  }

  // Cập nhật số tiền hiển thị
  function updateDisplayAmount(amount, note) {
    document.getElementById('displayAmount').textContent = formatCurrency(amount);
    document.getElementById('paymentNote').textContent = note;
  }

  // Định dạng tiền VNĐ
  function formatCurrency(amount) {
    return new Intl.NumberFormat('vi-VN').format(amount) + ' đ';
  }

  // Event listener khi đổi loại thanh toán
  document.getElementById('fullPayment').addEventListener('change', function() {
    if (this.checked) {
      updateDisplayAmount(totalAmount, 'Thanh toán toàn bộ');
    }
  });

  document.getElementById('depositPayment').addEventListener('change', function() {
    if (this.checked) {
      updateDisplayAmount(depositAmount, 'Đặt cọc 50% - Còn lại thanh toán khi check-in');
    }
  });

  // Form submission
  document.getElementById('paymentForm').addEventListener('submit', function(e) {
    const agreeTerms = document.getElementById('agreeTerms');
    if (!agreeTerms.checked) {
      e.preventDefault();
      alert('Vui lòng đồng ý với điều khoản và điều kiện để tiếp tục.');
      return false;
    }

    // Confirm trước khi submit
    const isDepositOnly = document.getElementById('depositPayment').checked;
    const amount = isDepositOnly ? depositAmount : totalAmount;
    const amountFormatted = formatCurrency(amount);

    if (!confirm(`Xác nhận thanh toán ${amountFormatted}?`)) {
      e.preventDefault();
      return false;
    }

    // Show loading state
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Đang xử lý thanh toán...';
  });

  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    // Set default selected payment method theo radio đang check
    const checkedMethod = document.querySelector('input[name="paymentMethod"]:checked');
    if (checkedMethod) {
      checkedMethod.closest('.payment-method').classList.add('selected');
    }
  });
</script>
</body>
</html>