<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý phòng Real-time - Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .room-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .room-card.available {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .room-card.booked {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: white;
        }

        .room-card.occupied {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
            color: white;
        }

        .room-card.maintenance {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }

        .room-number {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .room-status {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .status-icon {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 1.2rem;
        }

        .filter-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .stats-bar {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .modal-header {
            border-bottom: 2px solid #e9ecef;
        }

        .info-group {
            margin-bottom: 20px;
        }

        .info-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }

        .info-value {
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #007bff;
        }

        @media (max-width: 768px) {
            .room-card {
                height: 100px;
            }
            .room-number {
                font-size: 1.2rem;
            }
            .legend {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">
                    <i class="bi bi-building"></i> Quản lý phòng Real-time
                </h2>
                <button class="btn btn-outline-primary" onclick="refreshData()">
                    <i class="bi bi-arrow-clockwise"></i> Cập nhật
                </button>
            </div>
        </div>
    </div>

    <!-- Statistics Bar -->
    <div class="stats-bar">
        <div class="row">
            <div class="col-6 col-md-3">
                <div class="stat-item">
                    <div class="stat-number text-success" id="availableCount">12</div>
                    <small class="text-muted">Trống</small>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-item">
                    <div class="stat-number text-warning" id="bookedCount">8</div>
                    <small class="text-muted">Đã đặt</small>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-item">
                    <div class="stat-number text-danger" id="occupiedCount">15</div>
                    <small class="text-muted">Đang ở</small>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-item">
                    <div class="stat-number text-secondary" id="maintenanceCount">3</div>
                    <small class="text-muted">Bảo trì</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filter-section">
        <h5 class="mb-3">
            <i class="bi bi-funnel"></i> Bộ lọc
        </h5>

        <div class="row">
            <div class="col-md-4 mb-3">
                <label class="form-label">Trạng thái phòng</label>
                <select class="form-select" id="statusFilter" onchange="applyFilters()">
                    <option value="">Tất cả trạng thái</option>
                    <option value="available">Trống</option>
                    <option value="booked">Đã đặt</option>
                    <option value="occupied">Đang ở</option>
                    <option value="maintenance">Bảo trì</option>
                </select>
            </div>

            <div class="col-md-4 mb-3">
                <label class="form-label">Từ ngày</label>
                <input type="date" class="form-control" id="fromDate" onchange="applyFilters()">
            </div>

            <div class="col-md-4 mb-3">
                <label class="form-label">Đến ngày</label>
                <input type="date" class="form-control" id="toDate" onchange="applyFilters()">
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <span><strong>Chú thích:</strong></span>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #28a745, #20c997);"></div>
                <span>Trống</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #ffc107, #fd7e14);"></div>
                <span>Đã đặt</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #dc3545, #e83e8c);"></div>
                <span>Đang ở</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #6c757d, #495057);"></div>
                <span>Bảo trì</span>
            </div>
        </div>
    </div>

    <!-- Room Grid -->
    <div class="row" id="roomGrid">
        <!-- Rooms will be populated by JavaScript -->
    </div>
</div>

<!-- Room Detail Modal -->
<div class="modal fade" id="roomDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="bi bi-door-open"></i> Chi tiết phòng <span id="modalRoomNumber"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-group">
                            <div class="info-label">Số phòng</div>
                            <div class="info-value" id="detailRoomNumber"></div>
                        </div>

                        <div class="info-group">
                            <div class="info-label">Loại phòng</div>
                            <div class="info-value" id="detailRoomType"></div>
                        </div>

                        <div class="info-group">
                            <div class="info-label">Tầng</div>
                            <div class="info-value" id="detailFloor"></div>
                        </div>

                        <div class="info-group">
                            <div class="info-label">Trạng thái hiện tại</div>
                            <div class="info-value">
                                <span class="badge" id="detailCurrentStatus"></span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="info-group">
                            <div class="info-label">Tên khách hàng</div>
                            <div class="info-value" id="detailCustomerName"></div>
                        </div>

                        <div class="info-group">
                            <div class="info-label">Ngày check-in</div>
                            <div class="info-value" id="detailCheckIn"></div>
                        </div>

                        <div class="info-group">
                            <div class="info-label">Ngày check-out</div>
                            <div class="info-value" id="detailCheckOut"></div>
                        </div>

                        <div class="info-group">
                            <div class="info-label">Trạng thái booking</div>
                            <div class="info-value">
                                <span class="badge" id="detailBookingStatus"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-group">
                    <div class="info-label">Ghi chú đặc biệt</div>
                    <div class="info-value" id="detailSpecialRequests"></div>
                </div>
            </div>

            <div class="modal-footer">
                <div class="me-auto">
                    <label class="form-label">Cập nhật trạng thái phòng:</label>
                    <select class="form-select d-inline-block w-auto" id="newRoomStatus">
                        <option value="available">Trống</option>
                        <option value="occupied">Đang ở</option>
                        <option value="maintenance">Bảo trì</option>
                    </select>
                </div>

                <button type="button" class="btn btn-success" onclick="confirmBooking()">
                    <i class="bi bi-check-circle"></i> Xác nhận booking
                </button>
                <button type="button" class="btn btn-danger" onclick="cancelBooking()">
                    <i class="bi bi-x-circle"></i> Hủy booking
                </button>
                <button type="button" class="btn btn-primary" onclick="updateRoomStatus()">
                    <i class="bi bi-arrow-up-circle"></i> Cập nhật trạng thái
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Sample room data
    const rooms = [
        {
            id: 1, roomNumber: "101", floor: 1, roomType: "Standard Single", status: "available",
            customer: null, checkIn: null, checkOut: null, bookingStatus: null, specialRequests: ""
        },
        {
            id: 2, roomNumber: "102", floor: 1, roomType: "Standard Double", status: "booked",
            customer: "Nguyễn Văn A", checkIn: "2024-01-15", checkOut: "2024-01-18",
            bookingStatus: "confirmed", specialRequests: "Phòng không hút thuốc"
        },
        {
            id: 3, roomNumber: "103", floor: 1, roomType: "Standard Single", status: "occupied",
            customer: "Trần Thị B", checkIn: "2024-01-14", checkOut: "2024-01-16",
            bookingStatus: "checkedIn", specialRequests: "Yêu cầu phòng yên tĩnh"
        },
        {
            id: 4, roomNumber: "104", floor: 1, roomType: "Standard Double", status: "maintenance",
            customer: null, checkIn: null, checkOut: null, bookingStatus: null, specialRequests: "Sửa chữa điều hòa"
        },
        {
            id: 5, roomNumber: "201", floor: 2, roomType: "Deluxe Single", status: "available",
            customer: null, checkIn: null, checkOut: null, bookingStatus: null, specialRequests: ""
        },
        {
            id: 6, roomNumber: "202", floor: 2, roomType: "Deluxe Double", status: "booked",
            customer: "Lê Văn C", checkIn: "2024-01-16", checkOut: "2024-01-20",
            bookingStatus: "pending", specialRequests: "Giường đôi"
        },
        // Add more rooms for demonstration
    ];

    // Add more sample rooms
    for (let i = 7; i <= 40; i++) {
        const floor = Math.ceil(i / 10);
        const roomNum = (floor * 100) + (i % 10 || 10);
        const statuses = ['available', 'booked', 'occupied', 'maintenance'];
        const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];

        rooms.push({
            id: i,
            roomNumber: roomNum.toString(),
            floor: floor,
            roomType: ['Standard Single', 'Standard Double', 'Deluxe Single', 'Deluxe Double'][Math.floor(Math.random() * 4)],
            status: randomStatus,
            customer: randomStatus !== 'available' && randomStatus !== 'maintenance' ? `Khách ${i}` : null,
            checkIn: randomStatus !== 'available' && randomStatus !== 'maintenance' ? "2024-01-15" : null,
            checkOut: randomStatus !== 'available' && randomStatus !== 'maintenance' ? "2024-01-18" : null,
            bookingStatus: randomStatus === 'booked' ? 'confirmed' : randomStatus === 'occupied' ? 'checkedIn' : null,
            specialRequests: randomStatus === 'maintenance' ? 'Bảo trì định kỳ' : ''
        });
    }

    let filteredRooms = [...rooms];
    let currentRoomId = null;

    function getStatusIcon(status) {
        const icons = {
            available: 'bi-check-circle',
            booked: 'bi-calendar-check',
            occupied: 'bi-person-fill',
            maintenance: 'bi-tools'
        };
        return icons[status] || 'bi-question-circle';
    }

    function getStatusText(status) {
        const texts = {
            available: 'Trống',
            booked: 'Đã đặt',
            occupied: 'Đang ở',
            maintenance: 'Bảo trì'
        };
        return texts[status] || 'Không xác định';
    }

    function getBookingStatusBadge(status) {
        const badges = {
            confirmed: '<span class="badge bg-success">Đã xác nhận</span>',
            pending: '<span class="badge bg-warning">Đang chờ</span>',
            checkedIn: '<span class="badge bg-info">Đã check-in</span>',
            cancelled: '<span class="badge bg-danger">Đã hủy</span>'
        };
        return badges[status] || '<span class="badge bg-secondary">Không có</span>';
    }

    function getRoomStatusBadge(status) {
        const badges = {
            available: '<span class="badge bg-success">Trống</span>',
            booked: '<span class="badge bg-warning">Đã đặt</span>',
            occupied: '<span class="badge bg-danger">Đang ở</span>',
            maintenance: '<span class="badge bg-secondary">Bảo trì</span>'
        };
        return badges[status] || '<span class="badge bg-secondary">Không xác định</span>';
    }

    function renderRooms() {
        const roomGrid = document.getElementById('roomGrid');
        roomGrid.innerHTML = '';

        filteredRooms.forEach(room => {
            const roomCard = document.createElement('div');
            roomCard.className = 'col-6 col-sm-4 col-md-3 col-lg-2 mb-3';

            roomCard.innerHTML = `
                    <div class="room-card ${room.status}" onclick="showRoomDetail(${room.id})">
                        <i class="status-icon bi ${getStatusIcon(room.status)}"></i>
                        <div class="room-number">${room.roomNumber}</div>
                        <div class="room-status">${getStatusText(room.status)}</div>
                    </div>
                `;

            roomGrid.appendChild(roomCard);
        });

        updateStatistics();
    }

    function updateStatistics() {
        const stats = {
            available: 0,
            booked: 0,
            occupied: 0,
            maintenance: 0
        };

        filteredRooms.forEach(room => {
            stats[room.status]++;
        });

        document.getElementById('availableCount').textContent = stats.available;
        document.getElementById('bookedCount').textContent = stats.booked;
        document.getElementById('occupiedCount').textContent = stats.occupied;
        document.getElementById('maintenanceCount').textContent = stats.maintenance;
    }

    function showRoomDetail(roomId) {
        const room = rooms.find(r => r.id === roomId);
        if (!room) return;

        currentRoomId = roomId;

        document.getElementById('modalRoomNumber').textContent = room.roomNumber;
        document.getElementById('detailRoomNumber').textContent = room.roomNumber;
        document.getElementById('detailRoomType').textContent = room.roomType;
        document.getElementById('detailFloor').textContent = `Tầng ${room.floor}`;
        document.getElementById('detailCurrentStatus').innerHTML = getRoomStatusBadge(room.status);

        document.getElementById('detailCustomerName').textContent = room.customer || 'Không có';
        document.getElementById('detailCheckIn').textContent = room.checkIn || 'Không có';
        document.getElementById('detailCheckOut').textContent = room.checkOut || 'Không có';
        document.getElementById('detailBookingStatus').innerHTML = getBookingStatusBadge(room.bookingStatus);
        document.getElementById('detailSpecialRequests').textContent = room.specialRequests || 'Không có';

        document.getElementById('newRoomStatus').value = room.status;

        new bootstrap.Modal(document.getElementById('roomDetailModal')).show();
    }

    function applyFilters() {
        const statusFilter = document.getElementById('statusFilter').value;
        const fromDate = document.getElementById('fromDate').value;
        const toDate = document.getElementById('toDate').value;

        filteredRooms = rooms.filter(room => {
            let matchStatus = !statusFilter || room.status === statusFilter;

            let matchDate = true;
            if (fromDate && room.checkIn) {
                matchDate = matchDate && new Date(room.checkIn) >= new Date(fromDate);
            }
            if (toDate && room.checkOut) {
                matchDate = matchDate && new Date(room.checkOut) <= new Date(toDate);
            }

            return matchStatus && matchDate;
        });

        renderRooms();
    }

    function confirmBooking() {
        if (!currentRoomId) return;

        const room = rooms.find(r => r.id === currentRoomId);
        if (room && room.bookingStatus === 'pending') {
            room.bookingStatus = 'confirmed';
            showNotification('Đã xác nhận booking thành công!', 'success');
            showRoomDetail(currentRoomId); // Refresh modal
            renderRooms();
        }
    }

    function cancelBooking() {
        if (!currentRoomId) return;

        const room = rooms.find(r => r.id === currentRoomId);
        if (room && (room.bookingStatus === 'pending' || room.bookingStatus === 'confirmed')) {
            room.bookingStatus = 'cancelled';
            room.status = 'available';
            room.customer = null;
            room.checkIn = null;
            room.checkOut = null;
            room.specialRequests = '';

            showNotification('Đã hủy booking thành công!', 'warning');
            bootstrap.Modal.getInstance(document.getElementById('roomDetailModal')).hide();
            renderRooms();
        }
    }

    function updateRoomStatus() {
        if (!currentRoomId) return;

        const newStatus = document.getElementById('newRoomStatus').value;
        const room = rooms.find(r => r.id === currentRoomId);

        if (room) {
            room.status = newStatus;
            showNotification('Đã cập nhật trạng thái phòng thành công!', 'info');
            bootstrap.Modal.getInstance(document.getElementById('roomDetailModal')).hide();
            renderRooms();
        }
    }

    function refreshData() {
        showNotification('Đang cập nhật dữ liệu...', 'info');
        // Simulate data refresh
        setTimeout(() => {
            renderRooms();
            showNotification('Dữ liệu đã được cập nhật!', 'success');
        }, 1000);
    }

    function showNotification(message, type) {
        const toast = document.createElement('div');
        toast.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        toast.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

        document.body.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, 5000);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        renderRooms();

        // Set default dates
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('fromDate').value = today;

        const nextWeek = new Date();
        nextWeek.setDate(nextWeek.getDate() + 7);
        document.getElementById('toDate').value = nextWeek.toISOString().split('T')[0];
    });

    // Auto refresh every 30 seconds
    setInterval(() => {
        console.log('Auto refresh...');
        // In real application, this would fetch new data from server
    }, 30000);
</script>
</body>
</html>