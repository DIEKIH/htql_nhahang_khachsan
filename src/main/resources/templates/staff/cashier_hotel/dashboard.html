<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Booking & Khách lưu trú - Lễ tân</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        body {
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .layout-container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 280px;
            min-width: 280px;
            height: 100vh;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            flex-shrink: 0;
        }

        .sidebar .nav-link {
            color: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 8px;
            margin: 2px 10px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            background-color: rgba(255,255,255,0.2);
            color: white;
            transform: translateX(5px);
        }

        .sidebar .nav-link i {
            margin-right: 8px;
            width: 18px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            height: 100vh;
            overflow-y: auto;
            padding: 15px;
            background-color: #f8f9fa;
        }

        .header-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            border: none;
            height: 100px;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .content-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: none;
        }

        .btn-custom {
            border-radius: 6px;
            padding: 6px 16px;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-available { background-color: #d4edda; color: #155724; }
        .status-occupied { background-color: #f8d7da; color: #721c24; }
        .status-maintenance { background-color: #fff3cd; color: #856404; }
        .status-confirmed { background-color: #d1ecf1; color: #0c5460; }
        .status-checked-in { background-color: #d4edda; color: #155724; }
        .status-checked-out { background-color: #e2e3e5; color: #383d41; }
        .status-paid { background-color: #d4edda; color: #155724; }
        .status-unpaid { background-color: #f8d7da; color: #721c24; }

        .search-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .table-responsive {
            border-radius: 8px;
            overflow: hidden;
            max-height: 400px;
            overflow-y: auto;
        }

        .table {
            margin-bottom: 0;
            font-size: 0.9rem;
        }

        .table th {
            background-color: #f8f9fa;
            border: none;
            font-weight: 600;
            padding: 12px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table td {
            padding: 10px 12px;
            vertical-align: middle;
            border-color: #e9ecef;
        }

        .booking-row:hover {
            background-color: #f8f9fa;
        }

        .action-buttons .btn {
            margin: 2px;
        }

        @media (max-width: 768px) {
            .layout-container {
                flex-direction: column;
                height: auto;
            }
            .sidebar {
                width: 100%;
                height: auto;
                min-height: auto;
            }
            .main-content {
                height: auto;
                padding: 10px;
            }
            .quick-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<div class="layout-container">
    <!-- Sidebar Fragment -->
    <div th:fragment="receptionist_sidebar" class="sidebar">
        <div class="p-3">
            <div class="text-center mb-3">
                <i class="bi bi-building text-white fs-2"></i>
                <h6 class="text-white mt-1 mb-0">Lễ Tân</h6>
                <small class="text-white-50">Hệ thống quản lý</small>
            </div>

            <nav class="nav flex-column">
                <!-- Dashboard -->
                <a class="nav-link" href="/receptionist/dashboard">
                    <i class="bi bi-speedometer2"></i>
                    Tổng quan
                </a>

                <!-- Booking Management -->
                <a class="nav-link active" href="/receptionist/booking-management">
                    <i class="bi bi-calendar-check"></i>
                    Quản lý Booking
                </a>

                <!-- Payment & Invoice -->
                <a class="nav-link" href="/receptionist/payment-invoice">
                    <i class="bi bi-credit-card"></i>
                    Thanh toán & Hóa đơn
                </a>

                <!-- Room Status -->
                <a class="nav-link" href="/receptionist/room-status">
                    <i class="bi bi-house-gear"></i>
                    Trạng thái phòng
                </a>

                <!-- Walk-in Booking -->
                <a class="nav-link" href="/receptionist/walkin-booking">
                    <i class="bi bi-person-plus"></i>
                    Đặt phòng tại quầy
                </a>

                <!-- Room Service -->
                <a class="nav-link" href="/receptionist/room-service">
                    <i class="bi bi-concierge-bell"></i>
                    Dịch vụ phòng
                </a>

                <!-- Feedback -->
                <a class="nav-link" href="/receptionist/feedback">
                    <i class="bi bi-chat-heart"></i>
                    Feedback khách
                </a>

                <!-- Communication -->
                <a class="nav-link" href="/receptionist/communication">
                    <i class="bi bi-chat-dots"></i>
                    Liên lạc nội bộ
                </a>
            </nav>
        </div>

        <!-- User Info -->
        <div class="mt-auto p-3 border-top border-light border-opacity-25">
            <div class="d-flex align-items-center text-white">
                <i class="bi bi-person-circle fs-5 me-2"></i>
                <div>
                    <div class="fw-bold small" th:text="${session.user?.fullName ?: 'Lễ tân'}"></div>
                    <small class="opacity-75" style="font-size: 0.75rem;">Đang trực</small>
                </div>
            </div>
            <a href="/logout" class="btn btn-outline-light btn-sm w-100 mt-2" style="font-size: 0.8rem;">
                <i class="bi bi-box-arrow-right me-1"></i>
                Đăng xuất
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header-card p-3">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 class="mb-1">Quản lý Booking & Khách lưu trú</h4>
                    <p class="mb-0 opacity-75 small">Check-in/out, đổi phòng, gia hạn và quản lý toàn bộ booking</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="fs-6 fw-bold" id="current-time"></div>
                    <div style="font-size: 0.85rem;" class="opacity-75" th:text="${#dates.format(#dates.createNow(), 'EEEE, dd/MM/yyyy')}"></div>
                </div>
            </div>
        </div>

        <!-- Stats Row -->
        <div class="row g-2 mb-3">
            <div class="col-md-3 col-6">
                <div class="stat-card p-2 text-center">
                    <i class="bi bi-door-open text-success fs-3"></i>
                    <h5 class="mt-1 mb-0">12</h5>
                    <small class="text-muted">Check-in hôm nay</small>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card p-2 text-center">
                    <i class="bi bi-door-closed text-warning fs-3"></i>
                    <h5 class="mt-1 mb-0">8</h5>
                    <small class="text-muted">Check-out hôm nay</small>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card p-2 text-center">
                    <i class="bi bi-house-check text-info fs-3"></i>
                    <h5 class="mt-1 mb-0">45</h5>
                    <small class="text-muted">Phòng đang sử dụng</small>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card p-2 text-center">
                    <i class="bi bi-house text-primary fs-3"></i>
                    <h5 class="mt-1 mb-0">15</h5>
                    <small class="text-muted">Phòng trống</small>
                </div>
            </div>
        </div>

        <!-- Search & Quick Actions -->
        <div class="search-section">
            <div class="row align-items-end">
                <div class="col-md-4">
                    <label class="form-label fw-bold">Tìm kiếm booking</label>
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Mã booking hoặc tên khách..." id="searchInput">
                        <button class="btn btn-primary-custom" type="button">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">Lọc theo ngày</label>
                    <input type="date" class="form-control" id="dateFilter">
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">Trạng thái</label>
                    <select class="form-select" id="statusFilter">
                        <option value="">Tất cả</option>
                        <option value="CONFIRMED">Đã xác nhận</option>
                        <option value="CHECKED_IN">Đã check-in</option>
                        <option value="CHECKED_OUT">Đã check-out</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-outline-primary w-100" onclick="clearFilters()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Làm mới
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="btn btn-primary-custom btn-custom" onclick="showQRScanner()">
                <i class="bi bi-qr-code-scan me-2"></i>Scan QR Check-in
            </button>
            <button class="btn btn-success btn-custom" onclick="showWalkInBooking()">
                <i class="bi bi-person-plus me-2"></i>Đặt phòng tại quầy
            </button>
            <button class="btn btn-info btn-custom" onclick="showRoomStatus()">
                <i class="bi bi-house-gear me-2"></i>Xem trạng thái phòng
            </button>
            <button class="btn btn-warning btn-custom" onclick="refreshData()">
                <i class="bi bi-arrow-clockwise me-2"></i>Làm mới dữ liệu
            </button>
        </div>

        <!-- Booking Table -->
        <div class="content-card">
            <div class="card-header bg-light border-0 p-3">
                <h6 class="mb-0">
                    <i class="bi bi-list-check text-primary me-2"></i>
                    Danh sách Booking
                    <span class="badge bg-primary ms-2">24</span>
                </h6>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>Mã Booking</th>
                        <th>Khách hàng</th>
                        <th>Phòng</th>
                        <th>Check-in/out</th>
                        <th>Số khách</th>
                        <th>Tổng tiền</th>
                        <th>Trạng thái</th>
                        <th>Thanh toán</th>
                        <th class="text-center">Thao tác</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="booking-row">
                        <td>
                            <strong>RM1701234567</strong>
                            <br><small class="text-muted">25/12/2024</small>
                        </td>
                        <td>
                            <div>
                                <strong>Nguyễn Văn A</strong>
                                <br><small class="text-muted">0901234567</small>
                            </div>
                        </td>
                        <td>
                            <span class="fw-bold">101</span> - Deluxe
                            <br><small class="text-muted">Tầng 1</small>
                        </td>
                        <td>
                            <div>25/12 → 27/12</div>
                            <small class="text-muted">14:00 - 12:00</small>
                        </td>
                        <td>
                            <i class="bi bi-people me-1"></i>3 người
                            <br><small class="text-muted">2 NL + 1 TE</small>
                        </td>
                        <td>
                            <strong>2,500,000đ</strong>
                            <br><small class="text-success">Cọc: 500,000đ</small>
                        </td>
                        <td>
                            <span class="status-badge status-confirmed">Đã xác nhận</span>
                        </td>
                        <td>
                            <span class="status-badge status-unpaid">Chưa thanh toán</span>
                        </td>
                        <td>
                            <div class="action-buttons text-center">
                                <button class="btn btn-primary btn-sm" onclick="checkIn('RM1701234567')">
                                    <i class="bi bi-door-open"></i>
                                </button>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                        <i class="bi bi-three-dots"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" onclick="changeRoom('RM1701234567')">
                                            <i class="bi bi-arrow-left-right me-2"></i>Đổi phòng
                                        </a></li>
                                        <li><a class="dropdown-item" href="#" onclick="extendStay('RM1701234567')">
                                            <i class="bi bi-calendar-plus me-2"></i>Gia hạn
                                        </a></li>
                                        <li><a class="dropdown-item" href="#" onclick="viewDetails('RM1701234567')">
                                            <i class="bi bi-eye me-2"></i>Chi tiết
                                        </a></li>
                                    </ul>
                                </div>
                            </div>
                        </td>
                    </tr>

                    <tr class="booking-row">
                        <td>
                            <strong>RM1701234568</strong>
                            <br><small class="text-muted">24/12/2024</small>
                        </td>
                        <td>
                            <div>
                                <strong>Trần Thị B</strong>
                                <br><small class="text-muted">0907654321</small>
                            </div>
                        </td>
                        <td>
                            <span class="fw-bold">205</span> - Suite
                            <br><small class="text-muted">Tầng 2</small>
                        </td>
                        <td>
                            <div>24/12 → 26/12</div>
                            <small class="text-muted">15:30 - 12:00</small>
                        </td>
                        <td>
                            <i class="bi bi-people me-1"></i>2 người
                            <br><small class="text-muted">2 NL</small>
                        </td>
                        <td>
                            <strong>4,200,000đ</strong>
                            <br><small class="text-success">Cọc: 1,000,000đ</small>
                        </td>
                        <td>
                            <span class="status-badge status-checked-in">Đã check-in</span>
                        </td>
                        <td>
                            <span class="status-badge status-paid">Đã thanh toán</span>
                        </td>
                        <td>
                            <div class="action-buttons text-center">
                                <button class="btn btn-warning btn-sm" onclick="checkOut('RM1701234568')">
                                    <i class="bi bi-door-closed"></i>
                                </button>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                        <i class="bi bi-three-dots"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" onclick="changeRoom('RM1701234568')">
                                            <i class="bi bi-arrow-left-right me-2"></i>Đổi phòng
                                        </a></li>
                                        <li><a class="dropdown-item" href="#" onclick="extendStay('RM1701234568')">
                                            <i class="bi bi-calendar-plus me-2"></i>Gia hạn
                                        </a></li>
                                        <li><a class="dropdown-item" href="#" onclick="printInvoice('RM1701234568')">
                                            <i class="bi bi-printer me-2"></i>In hóa đơn
                                        </a></li>
                                    </ul>
                                </div>
                            </div>
                        </td>
                    </tr>

                    <tr class="booking-row">
                        <td>
                            <strong>RM1701234569</strong>
                            <br><small class="text-muted">25/12/2024</small>
                        </td>
                        <td>
                            <div>
                                <strong>Lê Văn C</strong>
                                <br><small class="text-muted">0909876543</small>
                            </div>
                        </td>
                        <td>
                            <span class="fw-bold">108</span> - Standard
                            <br><small class="text-muted">Tầng 1</small>
                        </td>
                        <td>
                            <div>25/12 → 28/12</div>
                            <small class="text-muted">16:00 - 12:00</small>
                        </td>
                        <td>
                            <i class="bi bi-people me-1"></i>4 người
                            <br><small class="text-muted">2 NL + 2 TE</small>
                        </td>
                        <td>
                            <strong>3,600,000đ</strong>
                            <br><small class="text-warning">Chưa cọc</small>
                        </td>
                        <td>
                            <span class="status-badge status-confirmed">Đã xác nhận</span>
                        </td>
                        <td>
                            <span class="status-badge status-unpaid">Chưa thanh toán</span>
                        </td>
                        <td>
                            <div class="action-buttons text-center">
                                <button class="btn btn-primary btn-sm" onclick="checkIn('RM1701234569')">
                                    <i class="bi bi-door-open"></i>
                                </button>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                        <i class="bi bi-three-dots"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" onclick="collectDeposit('RM1701234569')">
                                            <i class="bi bi-piggy-bank me-2"></i>Thu cọc
                                        </a></li>
                                        <li><a class="dropdown-item" href="#" onclick="changeRoom('RM1701234569')">
                                            <i class="bi bi-arrow-left-right me-2"></i>Đổi phòng
                                        </a></li>
                                        <li><a class="dropdown-item" href="#" onclick="extendStay('RM1701234569')">
                                            <i class="bi bi-calendar-plus me-2"></i>Gia hạn
                                        </a></li>
                                    </ul>
                                </div>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="card-footer bg-light border-0 p-3">
                <nav aria-label="Booking pagination">
                    <ul class="pagination pagination-sm justify-content-center mb-0">
                        <li class="page-item disabled">
                            <span class="page-link">Trước</span>
                        </li>
                        <li class="page-item active">
                            <span class="page-link">1</span>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">2</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">3</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">Sau</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<!-- QR Scanner Modal -->
<div class="modal fade" id="qrScannerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-qr-code-scan me-2"></i>Quét mã QR booking</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="text-center p-4" style="border: 3px dashed #667eea; border-radius: 15px; background-color: #f8f9ff;">
                    <i class="bi bi-camera fs-1 text-primary mb-3"></i>
                    <p>Hướng camera vào mã QR trên booking</p>
                    <button class="btn btn-primary-custom btn-custom">
                        <i class="bi bi-camera me-2"></i>Bật camera
                    </button>
                </div>

                <div class="mt-3">
                    <label class="form-label">Hoặc nhập mã booking thủ công:</label>
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Nhập mã booking...">
                        <button class="btn btn-primary-custom" type="button">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Change Room Modal -->
<div class="modal fade" id="changeRoomModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-arrow-left-right me-2"></i>Đổi phòng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Thông tin hiện tại</h6>
                        <div class="card bg-light">
                            <div class="card-body">
                                <p><strong>Booking:</strong> <span id="currentBookingCode"></span></p>
                                <p><strong>Khách:</strong> <span id="currentCustomer"></span></p>
                                <p><strong>Phòng hiện tại:</strong> <span id="currentRoom"></span></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Chọn phòng mới</h6>
                        <div class="mb-3">
                            <select class="form-select" id="newRoomSelect">
                                <option value="">Chọn phòng...</option>
                                <option value="102">102 - Standard (Trống)</option>
                                <option value="103">103 - Deluxe (Trống)</option>
                                <option value="201">201 - Suite (Trống)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Lý do đổi phòng</label>
                            <textarea class="form-control" rows="3" placeholder="Nhập lý do..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary-custom" onclick="confirmChangeRoom()">
                    <i class="bi bi-check-lg me-2"></i>Xác nhận đổi phòng
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Extend Stay Modal -->
<div class="modal fade" id="extendStayModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-calendar-plus me-2"></i>Gia hạn lưu trú</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Booking hiện tại</label>
                    <input type="text" class="form-control" id="extendBookingCode" readonly>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">Ngày check-out cũ</label>
                        <input type="date" class="form-control" id="oldCheckOut" readonly>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Ngày check-out mới</label>
                        <input type="date" class="form-control" id="newCheckOut">
                    </div>
                </div>
                <div class="mt-3">
                    <label class="form-label">Số đêm thêm</label>
                    <input type="number" class="form-control" id="additionalNights" readonly>
                </div>
                <div class="mt-3">
                    <label class="form-label">Tiền phụ thu</label>
                    <input type="text" class="form-control" id="additionalAmount" readonly>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary-custom" onclick="confirmExtendStay()">
                    <i class="bi bi-check-lg me-2"></i>Xác nhận gia hạn
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Deposit Modal -->
<div class="modal fade" id="depositModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-piggy-bank me-2"></i>Thu tiền cọc</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Mã booking</label>
                    <input type="text" class="form-control" id="depositBookingCode" readonly>
                </div>
                <div class="mb-3">
                    <label class="form-label">Số tiền cọc</label>
                    <input type="number" class="form-control" id="depositAmount" placeholder="Nhập số tiền cọc...">
                </div>
                <div class="mb-3">
                    <label class="form-label">Phương thức thanh toán</label>
                    <select class="form-select" id="depositPaymentMethod">
                        <option value="CASH">Tiền mặt</option>
                        <option value="BANK_TRANSFER">Chuyển khoản</option>
                        <option value="CREDIT_CARD">Thẻ tín dụng</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Ghi chú</label>
                    <textarea class="form-control" id="depositNote" rows="2" placeholder="Ghi chú thêm..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary-custom" onclick="confirmCollectDeposit()">
                    <i class="bi bi-check-lg me-2"></i>Xác nhận thu cọc
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap 5 JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

<script>
    // Current time display
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('vi-VN', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        document.getElementById('current-time').textContent = timeString;
    }

    setInterval(updateTime, 1000);
    updateTime();

    // Quick action functions
    function showQRScanner() {
        new bootstrap.Modal(document.getElementById('qrScannerModal')).show();
    }

    function showWalkInBooking() {
        window.location.href = '/receptionist/walkin-booking';
    }

    function showRoomStatus() {
        window.location.href = '/receptionist/room-status';
    }

    function refreshData() {
        location.reload();
    }

    function clearFilters() {
        document.getElementById('searchInput').value = '';
        document.getElementById('dateFilter').value = '';
        document.getElementById('statusFilter').value = '';
        // Here you would trigger a data refresh
    }

    // Booking action functions
    function checkIn(bookingCode) {
        if (confirm('Xác nhận check-in cho booking ' + bookingCode + '?')) {
            // API call to check-in
            console.log('Check-in booking:', bookingCode);
            // Update UI or refresh data
            alert('Check-in thành công!');
        }
    }

    function checkOut(bookingCode) {
        if (confirm('Xác nhận check-out cho booking ' + bookingCode + '?')) {
            // API call to check-out
            console.log('Check-out booking:', bookingCode);
            alert('Check-out thành công!');
        }
    }

    function changeRoom(bookingCode) {
        // Populate modal with current booking info
        document.getElementById('currentBookingCode').textContent = bookingCode;
        document.getElementById('currentCustomer').textContent = 'Nguyễn Văn A'; // Get from data
        document.getElementById('currentRoom').textContent = '101 - Deluxe'; // Get from data

        new bootstrap.Modal(document.getElementById('changeRoomModal')).show();
    }

    function confirmChangeRoom() {
        const newRoom = document.getElementById('newRoomSelect').value;
        if (!newRoom) {
            alert('Vui lòng chọn phòng mới!');
            return;
        }

        // API call to change room
        console.log('Change room to:', newRoom);
        alert('Đổi phòng thành công!');
        bootstrap.Modal.getInstance(document.getElementById('changeRoomModal')).hide();
    }

    function extendStay(bookingCode) {
        // Populate modal with current booking info
        document.getElementById('extendBookingCode').value = bookingCode;
        document.getElementById('oldCheckOut').value = '2024-12-27'; // Get from data

        // Calculate additional cost when date changes
        document.getElementById('newCheckOut').addEventListener('change', function() {
            const oldDate = new Date(document.getElementById('oldCheckOut').value);
            const newDate = new Date(this.value);
            const diffTime = Math.abs(newDate - oldDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            document.getElementById('additionalNights').value = diffDays;
            document.getElementById('additionalAmount').value = (diffDays * 1200000).toLocaleString('vi-VN') + 'đ';
        });

        new bootstrap.Modal(document.getElementById('extendStayModal')).show();
    }

    function confirmExtendStay() {
        const newCheckOut = document.getElementById('newCheckOut').value;
        if (!newCheckOut) {
            alert('Vui lòng chọn ngày check-out mới!');
            return;
        }

        // API call to extend stay
        console.log('Extend stay to:', newCheckOut);
        alert('Gia hạn lưu trú thành công!');
        bootstrap.Modal.getInstance(document.getElementById('extendStayModal')).hide();
    }

    function collectDeposit(bookingCode) {
        document.getElementById('depositBookingCode').value = bookingCode;
        new bootstrap.Modal(document.getElementById('depositModal')).show();
    }

    function confirmCollectDeposit() {
        const amount = document.getElementById('depositAmount').value;
        if (!amount) {
            alert('Vui lòng nhập số tiền cọc!');
            return;
        }

        // API call to collect deposit
        console.log('Collect deposit:', amount);
        alert('Thu cọc thành công!');
        bootstrap.Modal.getInstance(document.getElementById('depositModal')).hide();
    }

    function viewDetails(bookingCode) {
        // Navigate to booking details page or show modal
        window.location.href = '/receptionist/booking-details/' + bookingCode;
    }

    function printInvoice(bookingCode) {
        // Open print invoice page in new window
        window.open('/receptionist/invoice/' + bookingCode, '_blank');
    }

    // Search and filter functionality
    document.getElementById('searchInput').addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });

    document.getElementById('dateFilter').addEventListener('change', performSearch);
    document.getElementById('statusFilter').addEventListener('change', performSearch);

    function performSearch() {
        const searchTerm = document.getElementById('searchInput').value;
        const dateFilter = document.getElementById('dateFilter').value;
        const statusFilter = document.getElementById('statusFilter').value;

        // API call to filter bookings
        console.log('Search:', { searchTerm, dateFilter, statusFilter });

        // Here you would update the table with filtered results
    }

    // Set active navigation
    document.addEventListener('DOMContentLoaded', function() {
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.sidebar .nav-link');

        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === currentPath ||
                (currentPath.includes('booking') && link.getAttribute('href').includes('booking-management'))) {
                link.classList.add('active');
            }
        });
    });

    // Real-time updates (optional)
    setInterval(function() {
        // Refresh booking data every 30 seconds
        // performSearch();
    }, 30000);
</script>
</body>
</html>